<!-- Used for creating or editing a blog post.
The same template is shared by both "new post" and "edit post" views. -->

{% extends 'blog/base.html' %}

{% block content %}
<div style="min-height: 80vh; background: #fff; display: flex; align-items: center; justify-content: center; padding: 10px;">
    <div style="display: flex; gap: 48px; align-items: center; justify-content: center;">
        <div class="login-card" style="background: #fff; border-radius: 28px; box-shadow: 0 2px 16px rgba(207,109,150,0.08); padding: 48px 48px 36px 48px; max-width: 800px; min-width: 520px; width: 100%; text-align: center;">
            <h1 style="font-family: 'Lobster', cursive; color: #a55c8f; font-size: 2.2rem; margin-bottom: 8px;">New post</h1>
            <div style="color: #6c757d; font-size: 1.08rem; margin-bottom: 18px;">We love hearing your stories! Share your content with our community!</div>
            <form method="POST" enctype="multipart/form-data" class="post-form" style="text-align:left;">{% csrf_token %}
                {{ form.media }}
                <div style="margin-bottom: 16px; display: flex; align-items: center; gap: 0px; justify-content: flex-start;">
                    <label for="id_title" style="font-weight: 500; color: #6c757d; min-width: 80px; text-align: left;">Title:</label>
                    <div style="flex: 1;">{{ form.title }}</div>
                </div>
                <div style="margin-bottom: 16px; display: flex; align-items: flex-start; gap: 0px; justify-content: flex-start;">
                    <label for="id_text" style="font-weight: 500; color: #6c757d; min-width: 80px; text-align: left;">Text:</label>
                    <div style="flex: 1;">{{ form.text }}</div>
                </div>
                <div style="margin-bottom: 16px;">
                    <label for="id_image" style="cursor:pointer; display:inline-block; width: 160px; border: 2px solid #a55c8f; border-radius: 12px; background: #fff; display: flex; align-items: center; justify-content: center; flex-direction: row; padding: 6px 0; font-size: 1rem; color: #a55c8f; margin-bottom: 0;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="#a55c8f" viewBox="0 0 16 16" style="margin-right: 6px;">
                            <rect x="7" y="3" width="2" height="10" rx="1"/>
                            <rect x="3" y="7" width="10" height="2" rx="1"/>
                        </svg>
                        <span style="color:#a55c8f; font-size:1rem;">Add Photo</span>
                        <input id="id_image" name="image" type="file" style="display:none;">
                    </label>
                </div>
                <div id="image-preview-container" style="margin-bottom: 16px;">
                    <span style="display:block; font-weight:500; margin-bottom:6px;">Current image:</span>
                    <div style="display: flex; flex-direction: column; align-items: flex-start;">
                        <img id="image-preview" src="{% if form.instance.image %}{{ form.instance.image.url }}{% endif %}" alt="Current image"
                            {% if form.instance.image %}
                                style="max-width: 300px; max-height: 300px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.07);"
                            {% else %}
                                style="display:none; max-width: 300px; max-height: 300px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.07);"
                            {% endif %}
                        >
                        <button type="button" id="remove-image-btn" class="save btn btn-secondary" style="margin-top: 10px; width: 140px;">Remove Photo</button>
                        <input type="hidden" name="remove_image" id="remove_image" value="0">
                    </div>
                </div>
                <button type="submit" class="save btn btn-secondary" style="width: 100%; background: #a55c8f; color: #fff; border-radius: 10px; border: none; font-size: 1.15rem; margin-bottom: 10px;">Save</button>
                                {% if form.instance.pk %}
                                    <a href="{% url 'post_detail' pk=form.instance.pk %}" class="btn btn-secondary" style="width: 100%; border: 2px solid #a55c8f; color: #a55c8f; background: #fff; border-radius: 10px; font-size: 1.15rem; margin-bottom: 0;">Cancel</a>
                                {% else %}
                                    <a href="{% url 'post_list' %}" class="btn btn-secondary" style="width: 100%; border: 2px solid #a55c8f; color: #a55c8f; background: #fff; border-radius: 10px; font-size: 1.15rem; margin-bottom: 0;">Cancel</a>
                                {% endif %}
                <style>
                    .login-card input,
                    .login-card textarea {
                        border-radius: 7px !important;
                        border: 1px solid #a55c8f !important;
                        box-shadow: none !important;
                    }
                    .login-card textarea {
                        min-height: 120px !important;
                        max-height: 180px !important;
                        height: 140px !important;
                    }
                </style>
                <script>
                    document.addEventListener('DOMContentLoaded', function() {
                        var fileInput = document.getElementById('id_image');
                        var previewImg = document.getElementById('image-preview');
                        var removeBtn = document.getElementById('remove-image-btn');
                        var removeInput = document.getElementById('remove_image');
                        if (fileInput) {
                            fileInput.addEventListener('change', function(e) {
                                if (fileInput.files && fileInput.files[0]) {
                                    var reader = new FileReader();
                                    reader.onload = function(ev) {
                                        previewImg.src = ev.target.result;
                                        previewImg.style.display = 'block';
                                        if (removeInput) removeInput.value = '0';
                                    }
                                    reader.readAsDataURL(fileInput.files[0]);
                                }
                            });
                        }
                        if (removeBtn) {
                            removeBtn.addEventListener('click', function() {
                                previewImg.src = '';
                                previewImg.style.display = 'none';
                                if (removeInput) removeInput.value = '1';
                            });
                        }
                    });
                </script>
            </form>
        </div>
        <div class="post-illustration" style="display: flex; align-items: center; justify-content: center;">
            <img src="/static/blog/img/illustrationedit.png" alt="Post illustration" style="max-width: 340px; width: 100%; height: auto;">
        </div>
    </div>
</div>
{% endblock %}